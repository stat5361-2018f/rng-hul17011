---
title: "Mixture Proposal"
output: pdf_document
author: "Hukai Luo"
date: "`r format(Sys.time(), '%d %B %Y')`"
abstract:
    In this assignment we will use the a mixture of the beta distribution as the instrumental density to sample from a function.
---

# 1 Mixture Proposal

Let $f$ be a probability density on $(0,1)$ such that
\begin{align*}
  f(x) \propto \frac{x^{\theta-1}}{1+x^2} + \sqrt{2+x^2}
  (1-x)^{\beta-1}, \quad 0<x<1.
\end{align*}

- Design a procedure (pseudo-code) to sample from $f$ using a mixture of
  Beta distributions as the instrumental density.  That is, the instrumental
  density should have the form
  \begin{align*}
    \sum_{k=1}^m p_k g_k(x),
  \end{align*}
  where $p_k$ are weights and $g_k$ are densities of Beta
  distributions.  Specify your choice of the mixture. Implement your
  algorithm in an R function. Graph the estimated density of a random sample
  of $n = 10,000$ generated by your procedure and $f$ for at least one
  $(\theta, \beta)$.
- As shown in class, $f(x)$ can also be sampled using
  rejection sampling, by dealing with the two components
  \begin{align*}
    \frac{x^{\theta-1}}{1+x^2}, \quad \sqrt{2+x^2}
    (1-x)^{\beta-1}
  \end{align*}
  separately using individual Beta distributions.  Design a procedure
  (pseudo-code) to do this; implement it with an R function; overlay the
  estimated density of a random sample of size $n = 10,000$ generated by
  your procedure and $f$.
  
# 2 Procedue, sample from $f$

let's define:
\[q(x) = \frac{x^{\theta-1}}{1+x^2} + \sqrt{2+x^2}(1-x)^{\beta-1}\]
since $1+x^2>=1$ and $\sqrt{2 + x^{2}} \leq \sqrt{2 +1} =\sqrt{3}$, we can say:
\[q(x) \leq x^{\theta - 1} + \sqrt{3} (1 - x)^{\beta - 1}\]
then define $g(x)$ as a density function as:
\[g(x) =  C(x^{\theta - 1} + \sqrt{3} (1 - x)^{\beta - 1}) \]
In order to calculate C:
\begin{align*}
&\int_0^1 (x^{\theta - 1} + \sqrt{3} (1 - x)^{\beta - 1})dx \\
&=\int_0^1 x^{\theta - 1}dx + \int_0^1 \sqrt{3} (1 - x)^{\beta - 1}dx\\
&=B(\theta,1) + \sqrt{3}B(1,\beta)
\end{align*}
so we can get C:
\[C = \frac{1}{B(\theta,1) + \sqrt{3}B(1,\beta)}\]
and $g(x)$:
\[g(x) =  \frac{1}{B(\theta,1) + \sqrt{3}B(1,\beta)}(x^{\theta - 1} + \sqrt{3} (1 - x)^{\beta - 1}) \]
change it to another expression:
\[g(x) =  \frac{B(\theta,1)}{B(\theta,1) + \sqrt{3}B(1,\beta)}\frac{x^{\theta - 1}}{B(\theta,1)} + \frac{\sqrt{3}B(1,\beta)}{B(\theta,1) + \sqrt{3}B(1,\beta)}\frac{ (1 - x)^{\beta - 1}}{B(1,\beta)} \]
we can find the weights below:
\[p1 = \frac{B(\theta,1)}{B(\theta,1) + \sqrt{3}B(1,\beta)}\] and \[p2 = \frac{\sqrt{3}B(1,\beta)}{B(\theta,1) + \sqrt{3}B(1,\beta)}\]

```{r code, results='hide'}
fprocedure <- function(size, theta, beta) {
  
  weight1 = beta(theta,1)/(beta(theta,1) + sqrt(3)*beta(1,beta))
  u = runif(size,0,1)
  sample = double(size)
  
  for (i in 1:size) {
    if (u[i] > weight1) {
      sample[i] <- rbeta(1, shape1 = theta, shape2 = 1)
    } 
    else {
      sample[i] <- rbeta(1, shape1 = 1, shape2 = beta)
    }
  }
  return(sample)
}
ffunc <- function(x, theta, beta){
  x ^ (theta - 1)/(1 + x^2) + sqrt(2 + x^2) * (1 - x)^(beta - 1)
}
```
next let's assume $\theta = 2$, $\beta =2$, and $size = 10000$
```{r code2, results='hide'}
theta <- 2
beta <- 4
size <-10000
sample <- fprocedure(size, theta, beta)
plot(density(sample), col = "red")
curve(ffunc(x,theta = 2,beta =4)/0.70587, xlim = c(0,1), add = TRUE, col = "blue")
legend("topright", legend = c("Procedure sample", "True Density"), 
      col = c("red","blue"), lty = c(1,1))
```

# 3 Rejection sampling, sample from $f$

In this section we will use two components to sample from $f$,
\[q_1(x) = \frac{x^{\theta-1}}{1+x^2}\]
\[q_2(x) = \sqrt{2+x^2}(1-x)^{\beta-1}\]
we can get:
\[q_{1}(x) = \frac{x^{\theta - 1}}{1 + x^{2}} \leq B(\theta, 1) \cdot \frac{x^{\theta - 1}}{B(\theta, 1)} = \alpha_{1} \cdot g_{1}(x)\]
also:
\[q_{2}(x) = \sqrt{2 + x^{2}} (1 - x)^{\beta - 1}\leq  \sqrt{3} (1 - x)^{\beta - 1} = \sqrt{3} B(1, \beta) \cdot \frac{(1 - x)^{\beta - 1}}{B(1, \beta)} = \alpha_{2} \cdot g_{2}(x)\]
```{r code3, results='hide'}
frejection <- function(size, theta, beta) {
  iter <- 0
  weight1 = beta(theta,1)/(beta(theta,1) + sqrt(3)*beta(1,beta))
  sample = double(0)
  
  while (iter < size) {
    
   u <- runif(1, 0, 1)
    
    if(u < weight1){
      x <- rbeta(1, shape1 = theta, shape2 = 1)
      u1 <- runif(1, 0, 1)
      
      if(u1 <= 1/(1 + x^2)){
        sample <- append(sample, x)
        iter <- iter + 1
      }
    }
    else{
      x <- rbeta(1, shape1 = 1, shape2 = beta)
      u2 <- runif(1, 0, 1)
      
      if(u2 <= sqrt(2 + x^2)/sqrt(3)){
        sample <- append(sample, x)
        iter <- iter + 1
      }
    }
  }
  return(sample)
}
ffunc <- function(x, theta, beta){
  x ^ (theta - 1)/(1 + x^2) + sqrt(2 + x^2) * (1 - x)^(beta - 1)
}
```
and sample it
```{r code4, results='hide'}
theta <- 2
beta <- 4
size <-10000
sample <- frejection(size, theta, beta)
plot(density(sample), col = "red")
curve(ffunc(x,theta = 2,beta =4)/0.70587, xlim = c(0,1), add = TRUE, col = "blue")
legend("topright", legend = c("Procedure sample", "True Density"), 
      col = c("red","blue"), lty = c(1,1))
```




















